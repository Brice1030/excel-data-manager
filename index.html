<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel CRUD Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0F0F23 0%, #1A1A2E 50%, #16213E 100%);
            min-height: 100vh;
            color: #E2E8F0;
            line-height: 1.6;
            margin: 0;
            overflow-x: hidden;
        }

        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 160px;
            background: linear-gradient(180deg, #1E1E3F 0%, #2D2D5A 100%);
            border-right: 1px solid rgba(255,255,255,0.1);
            padding: 15px 0;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 100;
            box-shadow: 4px 0 20px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 0 15px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 15px;
        }

        .sidebar-header h2 {
            color: #FFD700;
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sidebar-header p {
            color: #94A3B8;
            font-size: 0.7rem;
            font-weight: 300;
        }

        .sidebar-nav {
            padding: 0 20px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            color: #CBD5E0;
            text-decoration: none;
            border-radius: 6px;
            margin-bottom: 3px;
            transition: all 0.3s ease;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.8rem;
        }

        .nav-item:hover, .nav-item.active {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
            transform: translateX(5px);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .nav-item .icon {
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 30px;
            left: 30px;
            right: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            text-align: center;
        }

        .sidebar-footer p {
            color: #64748B;
            font-size: 0.8rem;
            margin-bottom: 10px;
        }

        .main-content {
            flex: 1;
            margin-left: 160px;
            min-height: 100vh;
            background: linear-gradient(135deg, #0F0F23 0%, #1A1A2E 50%, #16213E 100%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: #F1F5F9;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.8;
            font-weight: 300;
            color: #94A3B8;
        }

        .main-panel {
            background: rgba(30, 30, 63, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .upload-section {
            border: 3px dashed rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            background: rgba(255, 215, 0, 0.05);
            color: #E2E8F0;
        }

        .upload-section:hover {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
        }

        .upload-section.dragover {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.15);
            transform: scale(1.02);
        }

        .upload-section h3 {
            color: #F1F5F9;
            margin-bottom: 15px;
        }

        .upload-section p {
            color: #94A3B8;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #0F0F23;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
            background: linear-gradient(135deg, #FFA500, #FF8C00);
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(30, 30, 63, 0.6);
            color: #E2E8F0;
            backdrop-filter: blur(10px);
        }

        .search-box::placeholder {
            color: #94A3B8;
        }

        .search-box:focus {
            outline: none;
            border-color: #FFD700;
            background: rgba(30, 30, 63, 0.9);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        .filter-select {
            padding: 12px 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            font-size: 1rem;
            background: rgba(30, 30, 63, 0.6);
            color: #E2E8F0;
            cursor: pointer;
            min-width: 150px;
            backdrop-filter: blur(10px);
        }

        .filter-select option {
            background: #1E1E3F;
            color: #E2E8F0;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            background: rgba(30, 30, 63, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        th {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #0F0F23;
            padding: 12px 10px;
            text-align: left;
            font-weight: 700;
            font-size: 0.8rem;
            letter-spacing: 0.3px;
            text-transform: uppercase;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s ease;
            color: #E2E8F0;
        }

        tr:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: scale(1.001);
        }

        tr:nth-child(even) {
            background: rgba(255,255,255,0.02);
        }

        .editable {
            border: none;
            background: transparent;
            width: 100%;
            padding: 5px;
            font-size: inherit;
            border-radius: 5px;
            transition: all 0.2s ease;
            color: #E2E8F0;
        }

        .editable:focus {
            background: rgba(30, 30, 63, 0.8);
            outline: 2px solid #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .status {
            text-align: center;
            padding: 20px;
            color: #94A3B8;
            font-style: italic;
            font-size: 1.1rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1E1E3F, #2D2D5A);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .modal h2 {
            margin-bottom: 20px;
            color: #FFD700;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #E2E8F0;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(30, 30, 63, 0.6);
            color: #E2E8F0;
        }

        .form-group input::placeholder {
            color: #94A3B8;
        }

        .form-group input:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .sort-btn {
            background: none;
            border: none;
            color: #0F0F23;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 5px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .sort-btn:hover {
            opacity: 1;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .record-count {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #0F0F23;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
        }

        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #0F0F23;
            border: none;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .sidebar-toggle {
                display: block;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .container { 
                padding: 10px; 
                padding-top: 70px;
            }
            
            .header h1 { 
                font-size: 2rem; 
            }
            
            .main-panel { 
                padding: 20px; 
            }
            
            .controls { 
                flex-direction: column; 
            }
            
            .search-box { 
                min-width: auto; 
            }
        }
    </style>
</head>
<body>
    <button class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</button>
    
    <div class="app-layout">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><span class="icon">üìä</span> Excel Manager</h2>
                <p>Manage your data efficiently</p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                    <span class="icon">üè†</span>
                    Dashboard
                </a>
                <a href="#" class="nav-item" onclick="showSection('import')">
                    <span class="icon">üìÅ</span>
                    Import Data
                </a>
                <a href="#" class="nav-item" onclick="showSection('table')">
                    <span class="icon">üìã</span>
                    Data Table
                </a>
                <a href="#" class="nav-item" onclick="showSection('analytics')">
                    <span class="icon">üìà</span>
                    Analytics
                </a>
                <a href="#" class="nav-item" onclick="showSection('export')">
                    <span class="icon">üíæ</span>
                    Export Data
                </a>
                <a href="#" class="nav-item" onclick="showSection('database')">
                    <span class="icon">üóÑÔ∏è</span>
                    Generate DB
                </a>
                <a href="#" class="nav-item" onclick="showSection('settings')">
                    <span class="icon">‚öôÔ∏è</span>
                    Settings
                </a>
            </nav>
        </div>

        <div class="main-content">
            <div class="container">
                <div class="header">
                    <h1>Excel Data Manager</h1>
                    <p>Import, edit, search and manage your Excel data with professional tools</p>
                </div>

                <div class="main-panel fade-in">
                    <div class="upload-section" id="uploadSection">
                        <h3>Drop your Excel file here or click to browse</h3>
                        <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls">
                        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                            üìÅ Choose File
                        </button>
                        <button class="upload-btn" onclick="createNewFile()" style="margin-left: 10px; background: linear-gradient(135deg, #10B981, #059669);">
                            üìÑ Create New
                        </button>
                        <p>Supports .xlsx and .xls files</p>
                    </div>

                    <div class="controls" id="controls" style="display: none;">
                        <input type="text" class="search-box" id="searchBox" placeholder="üîç Search across all columns...">
                        <select class="filter-select" id="filterColumn">
                            <option value="">Filter by column</option>
                        </select>
                        <input type="text" class="search-box" id="filterValue" placeholder="Filter value..." style="min-width: 150px;">
                        <select class="filter-select" id="filterType">
                            <option value="contains">Contains</option>
                            <option value="equals">Equals</option>
                            <option value="starts">Starts with</option>
                            <option value="ends">Ends with</option>
                        </select>
                        <div class="record-count" id="recordCount">0 records</div>
                        <button class="btn btn-primary" onclick="addNewRecord()">‚ûï Add Row</button>
                        <button class="btn btn-primary" onclick="addNewColumn()">‚ûï Add Column</button>
                        <button class="btn btn-success" onclick="exportData()">üíæ Export</button>
                        <button class="btn btn-success" onclick="duplicateRow()">üìã Duplicate</button>
                        <button class="btn btn-success" onclick="bulkEdit()">‚úèÔ∏è Bulk Edit</button>
                        <button class="btn btn-primary" onclick="undo()">‚Ü∂ Undo</button>
                        <button class="btn btn-primary" onclick="redo()">‚Ü∑ Redo</button>
                        <button class="btn btn-success" onclick="formatCurrency()">üí∞ Currency</button>
                        <button class="btn btn-danger" onclick="clearData()">üóëÔ∏è Clear All</button>
                    </div>

                    <div id="tableContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="recordModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Add New Record</h2>
            <form id="recordForm"></form>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveRecord()">Save</button>
                <button class="btn" onclick="closeModal()" style="background: #e2e8f0;">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let currentData = [];
        let filteredData = [];
        let columns = [];
        let editingIndex = -1;

        // File handling
        document.getElementById('fileInput').addEventListener('change', handleFile);
        
        const uploadSection = document.getElementById('uploadSection');
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });
        
        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('dragover');
        });
        
        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        });

        function handleFile(event) {
            const file = event.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        function processFile(file) {
            showLoading('Processing file...');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    if (workbook.SheetNames.length > 1) {
                        showSheetSelector(workbook);
                        return;
                    }
                    
                    processSheet(workbook, workbook.SheetNames[0]);
                } catch (error) {
                    showError('Error reading file: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function processSheet(workbook, sheetName) {
            const sheet = workbook.Sheets[sheetName];
            const jsonData = XLSX.utils.sheet_to_json(sheet, {header: 1});
            
            if (jsonData.length === 0) {
                showError('No data found');
                return;
            }

            columns = jsonData[0].filter(col => col);
            currentData = jsonData.slice(1)
                .filter(row => row.some(cell => cell))
                .map((row, index) => {
                    const obj = {_id: index};
                    columns.forEach((col, colIndex) => {
                        obj[col] = row[colIndex] || '';
                    });
                    return obj;
                });
            
            filteredData = [...currentData];
            setupInterface();
            displayData();
            showSuccess(`Loaded ${currentData.length} records`);
        }

        function setupInterface() {
            document.getElementById('controls').style.display = 'flex';
            
            // Setup column filter
            const filterSelect = document.getElementById('filterColumn');
            filterSelect.innerHTML = '<option value="">Filter by column</option>';
            columns.forEach(col => {
                filterSelect.innerHTML += `<option value="${col}">${col}</option>`;
            });
            
            // Setup search and filters
            document.getElementById('searchBox').addEventListener('input', handleSearch);
            filterSelect.addEventListener('change', handleFilter);
            document.getElementById('filterValue').addEventListener('input', handleFilter);
            document.getElementById('filterType').addEventListener('change', handleFilter);
        }

        function displayData() {
            const container = document.getElementById('tableContainer');
            document.getElementById('recordCount').textContent = `${filteredData.length} records`;
            
            if (filteredData.length === 0) {
                container.innerHTML = '<div class="status">No data to display</div>';
                return;
            }

            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 40px;">#</th>
                                ${columns.map((col, index) => `<th draggable="true" ondragstart="dragStart(event, ${index})" ondragover="allowDrop(event)" ondrop="dropColumn(event, ${index})" style="cursor: move;">${col} <button class="sort-btn" onclick="sortBy('${col}')">‚ÜïÔ∏è</button> <button class="sort-btn" onclick="deleteColumn('${col}')" style="color: #EF4444;">‚úï</button></th>`).join('')}
                                <th style="width: 150px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            filteredData.forEach((row, index) => {
                html += `<tr>
                    <td style="text-align: center; color: #94A3B8;">${index + 1}</td>`;
                columns.forEach(col => {
                    html += `<td><input type="text" class="editable" value="${row[col] || ''}" 
                             onchange="updateCell(${row._id}, '${col}', this.value)"></td>`;
                });
                html += `
                    <td class="actions">
                        <button class="btn btn-primary" onclick="editRecord(${row._id})" title="Edit">‚úèÔ∏è</button>
                        <button class="btn btn-success" onclick="duplicateRecord(${row._id})" title="Duplicate">üìã</button>
                        <button class="btn btn-danger" onclick="deleteRecord(${row._id})" title="Delete">üóëÔ∏è</button>
                    </td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function handleSearch() {
            const query = document.getElementById('searchBox').value.toLowerCase();
            if (query === '') {
                filteredData = [...currentData];
            } else {
                filteredData = currentData.filter(row => 
                    columns.some(col => 
                        String(row[col] || '').toLowerCase().includes(query)
                    )
                );
            }
            displayData();
        }

        function handleFilter() {
            const column = document.getElementById('filterColumn').value;
            const filterValue = document.getElementById('filterValue').value.toLowerCase();
            const filterType = document.getElementById('filterType').value;
            const searchQuery = document.getElementById('searchBox').value.toLowerCase();
            
            let filtered = [...currentData];
            
            // Apply search filter
            if (searchQuery) {
                filtered = filtered.filter(row => 
                    columns.some(col => 
                        String(row[col] || '').toLowerCase().includes(searchQuery)
                    )
                );
            }
            
            // Apply column filter
            if (column && filterValue) {
                filtered = filtered.filter(row => {
                    const cellValue = String(row[column] || '').toLowerCase();
                    switch(filterType) {
                        case 'equals': return cellValue === filterValue;
                        case 'starts': return cellValue.startsWith(filterValue);
                        case 'ends': return cellValue.endsWith(filterValue);
                        default: return cellValue.includes(filterValue);
                    }
                });
            }
            
            if (column && !filterValue) {
                filtered.sort((a, b) => String(a[column] || '').localeCompare(String(b[column] || '')));
            }
            
            filteredData = filtered;
            displayData();
        }

        function updateCell(id, column, value) {
            saveState();
            const record = currentData.find(r => r._id === id);
            if (record) {
                record[column] = value;
                validateCell(record, column, value);
            }
        }

        function validateCell(record, column, value) {
            const input = document.querySelector(`input[onchange*="${record._id}"][onchange*="${column}"]`);
            if (!input) return;
            
            // Auto-detect currency columns
            const currencyKeywords = ['money', 'amount', 'prix', 'price', 'cost', 'salary', 'wage', 'fee', 'total'];
            const isCurrencyColumn = currencyKeywords.some(keyword => 
                column.toLowerCase().includes(keyword)
            );
            
            if (isCurrencyColumn && value && !isNaN(parseFloat(value)) && !value.includes('$') && !value.includes('‚Ç¨')) {
                input.style.backgroundColor = 'rgba(255, 215, 0, 0.1)';
                input.title = 'Click üí∞ Currency to format this column';
            }
            
            // Basic validation
            if (column.toLowerCase().includes('email') && value && !value.includes('@')) {
                input.style.borderColor = '#EF4444';
                input.title = 'Invalid email format';
            } else if (column.toLowerCase().includes('date') && value && isNaN(Date.parse(value))) {
                input.style.borderColor = '#EF4444';
                input.title = 'Invalid date format';
            } else if (!isCurrencyColumn || (value && (value.includes('$') || value.includes('‚Ç¨')))) {
                input.style.borderColor = '';
                input.style.backgroundColor = '';
                input.title = '';
            }
        }

        function addNewRecord() {
            saveState();
            editingIndex = -1;
            document.getElementById('modalTitle').textContent = 'Add New Record';
            setupModal();
            document.getElementById('recordModal').style.display = 'block';
        }

        function editRecord(id) {
            editingIndex = id;
            const record = currentData.find(r => r._id === id);
            document.getElementById('modalTitle').textContent = 'Edit Record';
            setupModal(record);
            document.getElementById('recordModal').style.display = 'block';
        }

        function setupModal(record = null) {
            const form = document.getElementById('recordForm');
            form.innerHTML = '';
            
            columns.forEach(col => {
                form.innerHTML += `
                    <div class="form-group">
                        <label for="field_${col}">${col}</label>
                        <input type="text" id="field_${col}" value="${record ? (record[col] || '') : ''}">
                    </div>
                `;
            });
        }

        function saveRecord() {
            const formData = {};
            columns.forEach(col => {
                formData[col] = document.getElementById(`field_${col}`).value;
            });

            if (editingIndex === -1) {
                // Add new record
                const newId = Math.max(...currentData.map(r => r._id), -1) + 1;
                formData._id = newId;
                currentData.push(formData);
            } else {
                // Update existing record
                const record = currentData.find(r => r._id === editingIndex);
                if (record) {
                    columns.forEach(col => {
                        record[col] = formData[col];
                    });
                }
            }

            filteredData = [...currentData];
            displayData();
            closeModal();
        }

        function deleteRecord(id) {
            if (confirm('Are you sure you want to delete this record?')) {
                saveState();
                currentData = currentData.filter(r => r._id !== id);
                filteredData = filteredData.filter(r => r._id !== id);
                displayData();
            }
        }

        function closeModal() {
            document.getElementById('recordModal').style.display = 'none';
        }

        function exportData() {
            if (currentData.length === 0) {
                showError('No data to export');
                return;
            }

            const exportData = currentData.map(row => {
                const obj = {};
                columns.forEach(col => {
                    obj[col] = row[col];
                });
                return obj;
            });

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data');
            
            const fileName = `exported_data_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showSuccess(`Exported ${currentData.length} records to ${fileName}`);
        }

        // Utility functions
        function showLoading(message) {
            document.getElementById('tableContainer').innerHTML = `<div class="status">‚è≥ ${message}</div>`;
        }

        function showError(message) {
            document.getElementById('tableContainer').innerHTML = `<div class="status" style="color: #EF4444;">‚ùå ${message}</div>`;
        }

        function showSuccess(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1000;
                background: linear-gradient(135deg, #10B981, #059669);
                color: white; padding: 15px 20px; border-radius: 10px;
                box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = `‚úÖ ${message}`;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function sortBy(column) {
            const isAsc = filteredData[0] && filteredData[0][column] <= filteredData[filteredData.length - 1][column];
            filteredData.sort((a, b) => {
                const aVal = String(a[column] || '').toLowerCase();
                const bVal = String(b[column] || '').toLowerCase();
                return isAsc ? bVal.localeCompare(aVal) : aVal.localeCompare(bVal);
            });
            displayData();
        }

        function showSheetSelector(workbook) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 1000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: linear-gradient(135deg, #1E1E3F, #2D2D5A);
                padding: 30px; border-radius: 20px; max-width: 400px;
                border: 1px solid rgba(255,255,255,0.1);
            `;
            
            content.innerHTML = `
                <h2 style="color: #FFD700; margin-bottom: 20px;">Select Sheet</h2>
                ${workbook.SheetNames.map(name => 
                    `<button class="btn btn-primary" style="display: block; width: 100%; margin: 10px 0;" 
                     onclick="processSheet(${JSON.stringify(workbook).replace(/"/g, '&quot;')}, '${name}'); document.body.removeChild(this.closest('div').parentElement);">
                        ${name}
                    </button>`
                ).join('')}
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('recordModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                currentData = [];
                filteredData = [];
                columns = [];
                document.getElementById('controls').style.display = 'none';
                document.getElementById('tableContainer').innerHTML = '';
                document.getElementById('fileInput').value = '';
                showSuccess('All data cleared');
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        if (currentData.length > 0) exportData();
                        break;
                    case 'n':
                        e.preventDefault();
                        if (columns.length > 0) addNewRecord();
                        break;
                    case 'z':
                        e.preventDefault();
                        if (e.shiftKey) redo();
                        else undo();
                        break;
                    case 'y':
                        e.preventDefault();
                        redo();
                        break;
                }
            }
        });

        // Sidebar navigation functions
        function showSection(section) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            
            const container = document.getElementById('tableContainer');
            
            switch(section) {
                case 'dashboard':
                    container.innerHTML = `
                        <div class="status">
                            <h2 style="color: #FFD700; margin-bottom: 20px;">üìä Dashboard</h2>
                            <p>Records: ${currentData.length}</p>
                            <p>Columns: ${columns.length}</p>
                            <p>Last Updated: ${new Date().toLocaleString()}</p>
                        </div>`;
                    break;
                case 'import':
                    container.innerHTML = '<div class="status">Use the upload section above to import your Excel files</div>';
                    break;
                case 'table':
                    if (currentData.length > 0) displayData();
                    else container.innerHTML = '<div class="status">No data loaded</div>';
                    break;
                case 'analytics':
                    showAnalytics();
                    break;
                case 'export':
                    if (currentData.length > 0) exportData();
                    else showError('No data to export');
                    break;
                case 'database':
                    generateDatabase();
                    break;
                case 'settings':
                    container.innerHTML = `
                        <div style="background: rgba(30, 30, 63, 0.6); padding: 20px; border-radius: 15px;">
                            <h2 style="color: #FFD700; margin-bottom: 20px;">‚öôÔ∏è Settings</h2>
                            <div style="display: grid; gap: 15px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="autoSave" checked> Auto-save changes
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="confirmDelete" checked> Confirm before delete
                                </label>
                                <div>
                                    <label>Export Format:</label>
                                    <select style="margin-left: 10px; padding: 5px; background: #1E1E3F; color: #E2E8F0; border: 1px solid #444;">
                                        <option value="xlsx">Excel (.xlsx)</option>
                                        <option value="csv">CSV (.csv)</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                            </div>
                        </div>`;
                    break;
            }
        }

        function showAnalytics() {
            if (currentData.length === 0) {
                document.getElementById('tableContainer').innerHTML = '<div class="status">No data for analytics</div>';
                return;
            }
            
            let html = `
                <div style="background: rgba(30, 30, 63, 0.6); padding: 20px; border-radius: 15px;">
                    <h2 style="color: #FFD700; margin-bottom: 20px;">üìà Data Analytics</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                            <canvas id="columnChart" width="400" height="200"></canvas>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                            <canvas id="pieChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                        <h3 style="color: #E2E8F0; margin-bottom: 15px;">Column Statistics</h3>
                        <table style="width: 100%;">
                            <thead><tr><th>Column</th><th>Filled</th><th>Empty</th><th>Unique Values</th><th>Fill Rate</th></tr></thead>
                            <tbody id="statsTable"></tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('tableContainer').innerHTML = html;
            
            // Generate statistics
            const analytics = columns.map(col => {
                const values = currentData.map(row => row[col]).filter(val => val);
                return {
                    column: col,
                    filled: values.length,
                    empty: currentData.length - values.length,
                    unique: new Set(values).size,
                    fillRate: ((values.length / currentData.length) * 100).toFixed(1)
                };
            });
            
            // Populate stats table
            const statsTable = document.getElementById('statsTable');
            statsTable.innerHTML = analytics.map(stat => `
                <tr>
                    <td>${stat.column}</td>
                    <td>${stat.filled}</td>
                    <td>${stat.empty}</td>
                    <td>${stat.unique}</td>
                    <td>${stat.fillRate}%</td>
                </tr>
            `).join('');
            
            // Create column fill rate chart
            new Chart(document.getElementById('columnChart'), {
                type: 'bar',
                data: {
                    labels: analytics.map(a => a.column),
                    datasets: [{
                        label: 'Fill Rate (%)',
                        data: analytics.map(a => a.fillRate),
                        backgroundColor: 'rgba(255, 215, 0, 0.6)',
                        borderColor: '#FFD700',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: 'Column Fill Rates', color: '#E2E8F0' },
                        legend: { labels: { color: '#E2E8F0' } }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            max: 100,
                            ticks: { color: '#E2E8F0' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: { 
                            ticks: { color: '#E2E8F0' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
            
            // Create data distribution pie chart
            const firstColumn = columns[0];
            if (firstColumn) {
                const values = currentData.map(row => row[firstColumn]).filter(val => val);
                const valueCounts = {};
                values.forEach(val => {
                    valueCounts[val] = (valueCounts[val] || 0) + 1;
                });
                
                const topValues = Object.entries(valueCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);
                
                new Chart(document.getElementById('pieChart'), {
                    type: 'pie',
                    data: {
                        labels: topValues.map(([label]) => label),
                        datasets: [{
                            data: topValues.map(([,count]) => count),
                            backgroundColor: [
                                '#FFD700', '#FFA500', '#FF8C00', '#FF6347', '#FF4500'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: `Top Values in "${firstColumn}"`, color: '#E2E8F0' },
                            legend: { labels: { color: '#E2E8F0' } }
                        }
                    }
                });
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function addNewColumn() {
            const columnName = prompt('Enter column name:');
            if (!columnName || columns.includes(columnName)) {
                if (columns.includes(columnName)) showError('Column already exists');
                return;
            }
            
            columns.push(columnName);
            currentData.forEach(row => row[columnName] = '');
            filteredData = [...currentData];
            
            setupInterface();
            displayData();
            showSuccess(`Added column: ${columnName}`);
        }

        function deleteColumn(columnName) {
            if (!confirm(`Delete column "${columnName}"? This cannot be undone.`)) return;
            
            columns = columns.filter(col => col !== columnName);
            currentData.forEach(row => delete row[columnName]);
            filteredData = [...currentData];
            
            setupInterface();
            displayData();
            showSuccess(`Deleted column: ${columnName}`);
        }

        function duplicateRecord(id) {
            const record = currentData.find(r => r._id === id);
            if (!record) return;
            
            const newId = Math.max(...currentData.map(r => r._id), -1) + 1;
            const newRecord = {...record, _id: newId};
            
            currentData.push(newRecord);
            filteredData = [...currentData];
            displayData();
            showSuccess('Record duplicated');
        }

        function duplicateRow() {
            if (currentData.length === 0) {
                showError('No data to duplicate');
                return;
            }
            
            const lastRecord = currentData[currentData.length - 1];
            duplicateRecord(lastRecord._id);
        }

        function bulkEdit() {
            if (currentData.length === 0) {
                showError('No data to edit');
                return;
            }
            
            const column = prompt('Enter column name to bulk edit:');
            if (!column || !columns.includes(column)) {
                showError('Invalid column name');
                return;
            }
            
            const newValue = prompt(`Enter new value for all rows in "${column}":`);
            if (newValue === null) return;
            
            currentData.forEach(row => row[column] = newValue);
            filteredData = [...currentData];
            displayData();
            showSuccess(`Updated ${currentData.length} records in column "${column}"`);
        }

        function saveSettings() {
            const autoSave = document.getElementById('autoSave').checked;
            const confirmDelete = document.getElementById('confirmDelete').checked;
            
            localStorage.setItem('excelAppSettings', JSON.stringify({
                autoSave,
                confirmDelete
            }));
            
            showSuccess('Settings saved successfully');
        }

        function createNewFile() {
            const numColumns = prompt('How many columns do you want?', '3');
            if (!numColumns || isNaN(numColumns) || numColumns < 1) return;
            
            const columnNames = [];
            for (let i = 0; i < parseInt(numColumns); i++) {
                const name = prompt(`Enter name for column ${i + 1}:`, `Column ${i + 1}`);
                if (!name) return;
                columnNames.push(name);
            }
            
            columns = columnNames;
            currentData = [];
            filteredData = [];
            
            // Add 5 empty rows to start
            for (let i = 0; i < 5; i++) {
                const row = {_id: i};
                columns.forEach(col => row[col] = '');
                currentData.push(row);
            }
            
            filteredData = [...currentData];
            setupInterface();
            displayData();
            showSuccess(`Created new file with ${columns.length} columns and 5 empty rows`);
        }

        let draggedColumnIndex = -1;
        let undoStack = [];
        let redoStack = [];

        function saveState() {
            undoStack.push(JSON.stringify({columns: [...columns], data: [...currentData]}));
            if (undoStack.length > 50) undoStack.shift();
            redoStack = [];
        }

        function undo() {
            if (undoStack.length === 0) return;
            redoStack.push(JSON.stringify({columns: [...columns], data: [...currentData]}));
            const state = JSON.parse(undoStack.pop());
            columns = state.columns;
            currentData = state.data;
            filteredData = [...currentData];
            setupInterface();
            displayData();
            showSuccess('Undone');
        }

        function redo() {
            if (redoStack.length === 0) return;
            undoStack.push(JSON.stringify({columns: [...columns], data: [...currentData]}));
            const state = JSON.parse(redoStack.pop());
            columns = state.columns;
            currentData = state.data;
            filteredData = [...currentData];
            setupInterface();
            displayData();
            showSuccess('Redone');
        }

        function dragStart(event, index) {
            draggedColumnIndex = index;
            event.dataTransfer.effectAllowed = 'move';
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function dropColumn(event, targetIndex) {
            event.preventDefault();
            
            if (draggedColumnIndex === -1 || draggedColumnIndex === targetIndex) return;
            
            // Reorder columns array
            const draggedColumn = columns[draggedColumnIndex];
            columns.splice(draggedColumnIndex, 1);
            columns.splice(targetIndex, 0, draggedColumn);
            
            // Update data display
            filteredData = [...currentData];
            displayData();
            showSuccess(`Moved column "${draggedColumn}" to position ${targetIndex + 1}`);
            
            draggedColumnIndex = -1;
        }

        const currencies = {
            'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'JPY': '¬•', 'CNY': '¬•', 'INR': '‚Çπ', 'KRW': '‚Ç©',
            'CAD': 'C$', 'AUD': 'A$', 'CHF': 'CHF', 'SEK': 'kr', 'NOK': 'kr', 'DKK': 'kr',
            'RUB': '‚ÇΩ', 'BRL': 'R$', 'MXN': '$', 'ZAR': 'R', 'SGD': 'S$', 'HKD': 'HK$',
            'NZD': 'NZ$', 'TRY': '‚Ç∫', 'PLN': 'z≈Ç', 'CZK': 'Kƒç', 'HUF': 'Ft', 'ILS': '‚Ç™',
            'AED': 'ÿØ.ÿ•', 'SAR': 'Ô∑º', 'THB': '‡∏ø', 'MYR': 'RM', 'IDR': 'Rp', 'PHP': '‚Ç±',
            'VND': '‚Ç´', 'EGP': 'E¬£', 'NGN': '‚Ç¶', 'KES': 'KSh', 'GHS': '‚Çµ', 'MAD': 'ÿØ.ŸÖ.',
            'TND': 'ÿØ.ÿ™', 'DZD': 'ÿØ.ÿ¨', 'LBP': 'ŸÑ.ŸÑ', 'JOD': 'ÿØ.ÿß', 'KWD': 'ÿØ.ŸÉ', 'QAR': 'ÿ±.ŸÇ',
            'OMR': 'ÿ±.ÿπ.', 'BHD': '.ÿØ.ÿ®', 'IRR': 'Ô∑º', 'AFN': 'ÿã', 'PKR': '‚Ç®', 'LKR': '‚Ç®',
            'NPR': '‚Ç®', 'BTN': 'Nu.', 'BDT': '‡ß≥', 'MMK': 'K', 'LAK': '‚Ç≠', 'KHR': '·üõ',
            'TWD': 'NT$', 'MOP': 'MOP$', 'BND': 'B$', 'FJD': 'FJ$', 'PGK': 'K', 'SBD': 'SI$',
            'TOP': 'T$', 'VUV': 'VT', 'WST': 'WS$', 'XPF': '‚Ç£', 'NCL': '‚Ç£', 'AMD': '÷è',
            'GEL': '‚Çæ', 'AZN': '‚Çº', 'UZS': '–ª–≤', 'KZT': '‚Ç∏', 'KGS': '–ª–≤', 'TJS': 'SM',
            'TMT': 'T', 'MNT': '‚ÇÆ', 'COP': '$', 'PEN': 'S/', 'CLP': '$', 'ARS': '$',
            'UYU': '$U', 'PYG': '‚Ç≤', 'BOB': 'Bs.', 'VES': 'Bs.S', 'GYD': 'GY$', 'SRD': 'Sr$',
            'TTD': 'TT$', 'JMD': 'J$', 'BBD': 'Bds$', 'BSD': 'B$', 'BZD': 'BZ$', 'GTQ': 'Q',
            'HNL': 'L', 'NIO': 'C$', 'CRC': '‚Ç°', 'PAB': 'B/.', 'DOP': 'RD$', 'HTG': 'G',
            'CUP': '‚Ç±', 'XCD': 'EC$', 'AWG': '∆í', 'ANG': '∆í', 'SVC': '‚Ç°', 'ISK': 'kr',
            'RON': 'lei', 'BGN': '–ª–≤', 'HRK': 'kn', 'RSD': '–¥–∏–Ω.', 'BAM': 'KM', 'MKD': '–¥–µ–Ω',
            'ALL': 'L', 'MDL': 'L', 'UAH': '‚Ç¥', 'BYN': 'Br', 'LTL': 'Lt', 'LVL': 'Ls',
            'EEK': 'kr', 'ETB': 'Br', 'KES': 'KSh', 'UGX': 'USh', 'TZS': 'TSh', 'RWF': 'FRw',
            'BIF': 'FBu', 'DJF': 'Fdj', 'ERN': 'Nfk', 'SOS': 'Sh.So.', 'SCR': '‚Ç®', 'MUR': '‚Ç®',
            'MGA': 'Ar', 'KMF': 'CF', 'MWK': 'MK', 'ZMW': 'ZK', 'BWP': 'P', 'SZL': 'L',
            'LSL': 'L', 'NAD': 'N$', 'AOA': 'Kz', 'MZN': 'MT', 'STN': 'Db', 'CVE': '$',
            'GMD': 'D', 'GNF': 'FG', 'LRD': 'L$', 'SLL': 'Le', 'CDF': 'FC', 'XAF': 'FCFA',
            'XOF': 'CFA', 'GIP': '¬£', 'FKP': '¬£', 'SHP': '¬£', 'JEP': '¬£', 'GGP': '¬£',
            'IMP': '¬£', 'TVD': 'A$', 'KID': 'A$', 'CKD': 'NZ$', 'NUD': 'A$', 'PND': 'A$'
        };

        function formatCurrency() {
            if (currentData.length === 0) {
                showError('No data to format');
                return;
            }
            
            // Auto-detect currency columns
            const currencyKeywords = ['money', 'amount', 'prix', 'price', 'cost', 'salary', 'wage', 'fee', 'total'];
            const currencyColumns = columns.filter(col => 
                currencyKeywords.some(keyword => col.toLowerCase().includes(keyword))
            );
            
            let column;
            if (currencyColumns.length === 1) {
                column = currencyColumns[0];
            } else if (currencyColumns.length > 1) {
                column = prompt(`Multiple currency columns found: ${currencyColumns.join(', ')}\nEnter column name:`);
            } else {
                column = prompt('Enter column name to format as currency:');
            }
            
            if (!column || !columns.includes(column)) {
                showError('Invalid column name');
                return;
            }
            
            // Create currency selection modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 1000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: linear-gradient(135deg, #1E1E3F, #2D2D5A);
                padding: 30px; border-radius: 20px; max-width: 500px; max-height: 70vh;
                border: 1px solid rgba(255,255,255,0.1); overflow-y: auto;
            `;
            
            const currencyOptions = Object.entries(currencies).map(([code, symbol]) => 
                `<button class="btn btn-primary" style="margin: 5px; min-width: 80px;" 
                 onclick="applyCurrency('${column}', '${code}', '${symbol}'); document.body.removeChild(this.closest('div').parentElement);">
                    ${code} ${symbol}
                </button>`
            ).join('');
            
            content.innerHTML = `
                <h2 style="color: #FFD700; margin-bottom: 20px;">Select Currency</h2>
                <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                    ${currencyOptions}
                </div>
                <button class="btn" onclick="document.body.removeChild(this.closest('div').parentElement);" 
                        style="margin-top: 20px; background: #e2e8f0;">Cancel</button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        function applyCurrency(column, currencyCode, symbol) {
            saveState();
            currentData.forEach(row => {
                const value = parseFloat(row[column]);
                if (!isNaN(value)) {
                    row[column] = `${symbol} ${value.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                }
            });
            
            filteredData = [...currentData];
            displayData();
            showSuccess(`Applied ${currencyCode} currency format to column "${column}"`);
        }

        function generateDatabase() {
            if (currentData.length === 0) {
                document.getElementById('tableContainer').innerHTML = '<div class="status">No data to generate database</div>';
                return;
            }
            
            // Generate SQL CREATE TABLE statement
            const tableName = prompt('Enter table name:', 'my_table') || 'my_table';
            
            let sql = `-- Database Schema for ${tableName}\n`;
            sql += `CREATE TABLE ${tableName} (\n`;
            sql += `    id INT PRIMARY KEY AUTO_INCREMENT,\n`;
            
            columns.forEach((col, index) => {
                const cleanCol = col.replace(/[^a-zA-Z0-9_]/g, '_').toLowerCase();
                const sampleValue = currentData[0] ? currentData[0][col] : '';
                
                let dataType = 'VARCHAR(255)';
                if (col.toLowerCase().includes('email')) dataType = 'VARCHAR(100)';
                else if (col.toLowerCase().includes('date')) dataType = 'DATE';
                else if (col.toLowerCase().includes('money') || col.toLowerCase().includes('amount') || col.toLowerCase().includes('prix')) dataType = 'DECIMAL(10,2)';
                else if (sampleValue && !isNaN(parseFloat(sampleValue))) dataType = 'DECIMAL(10,2)';
                
                sql += `    ${cleanCol} ${dataType}`;
                if (index < columns.length - 1) sql += ',';
                sql += '\n';
            });
            
            sql += ');\n\n';
            
            // Generate INSERT statements
            sql += `-- Sample Data Inserts\n`;
            currentData.slice(0, 5).forEach(row => {
                const values = columns.map(col => {
                    let value = row[col] || '';
                    if (typeof value === 'string') {
                        value = value.replace(/'/g, "''"); // Escape quotes
                        return `'${value}'`;
                    }
                    return value;
                }).join(', ');
                
                sql += `INSERT INTO ${tableName} (${columns.map(col => col.replace(/[^a-zA-Z0-9_]/g, '_').toLowerCase()).join(', ')}) VALUES (${values});\n`;
            });
            
            const container = document.getElementById('tableContainer');
            container.innerHTML = `
                <div style="background: rgba(30, 30, 63, 0.6); padding: 20px; border-radius: 15px;">
                    <h2 style="color: #FFD700; margin-bottom: 20px;">üóÑÔ∏è Database Schema</h2>
                    <div style="margin-bottom: 15px;">
                        <button class="btn btn-success" onclick="copyToClipboard()">üìã Copy SQL</button>
                        <button class="btn btn-primary" onclick="downloadSQL('${tableName}')">üíæ Download SQL</button>
                    </div>
                    <textarea id="sqlOutput" style="width: 100%; height: 400px; background: #0F0F23; color: #E2E8F0; border: 1px solid #444; border-radius: 10px; padding: 15px; font-family: monospace; font-size: 0.9rem;" readonly>${sql}</textarea>
                </div>
            `;
        }

        function copyToClipboard() {
            const textarea = document.getElementById('sqlOutput');
            textarea.select();
            document.execCommand('copy');
            showSuccess('SQL copied to clipboard');
        }

        function downloadSQL(tableName) {
            const sql = document.getElementById('sqlOutput').value;
            const blob = new Blob([sql], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${tableName}_schema.sql`;
            a.click();
            URL.revokeObjectURL(url);
            showSuccess('SQL file downloaded');
        }
    </script>
</body>
</html>